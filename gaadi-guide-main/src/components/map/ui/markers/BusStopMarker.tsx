import { Marker, Popup } from "react-leaflet";
import L from "leaflet";
import StopPopupDetails from "../StopPopupDetails";

interface BusStopMarkerProps {
  position: [number, number];
  lineColor: string;
  stopId?: string;
  stopName: string;
  showDetailedPopup?: boolean;
}

const BusStopMarker: React.FC<BusStopMarkerProps> = ({
  position,
  stopName,
  stopId,
  showDetailedPopup = true,
  lineColor = "#ff0000",
}) => {
  const customMarker = L.divIcon({
    className: "custom-marker",
    iconSize: [32, 42],
    iconAnchor: [16, 42],
    popupAnchor: [0, -42],
    html: `<div style="width: 32px; height: 42px;"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 64 73" fill="${lineColor}"><path d="M53.2137 52.9755L37.3025 68.813C36.6067 69.5064 35.7804 70.0564 34.8708 70.4316C33.9613 70.8069 32.9864 71 32.0019 71C31.0173 71 30.0424 70.8069 29.1329 70.4316C28.2234 70.0564 27.3971 69.5064 26.7013 68.813L10.7863 52.9755C6.59084 48.7993 3.73377 43.4785 2.57634 37.6861C1.41891 31.8937 2.0131 25.8897 4.28377 20.4334C6.55445 14.9771 10.3996 10.3135 15.3331 7.03239C20.2665 3.75128 26.0666 2 32 2C37.9334 2 43.7335 3.75128 48.6669 7.03239C53.6004 10.3135 57.4456 14.9771 59.7162 20.4334C61.9869 25.8897 62.5811 31.8937 61.4237 37.6861C60.2662 43.4785 57.4092 48.7993 53.2137 52.9755V52.9755Z" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M45.3333 28.3298V23.5564C45.3333 23.2446 45.3155 22.9329 45.28 22.6231C45.1019 20.992 44.421 19.4568 43.3317 18.2298C42.2423 17.0029 40.7985 16.145 39.2 15.775C34.4556 14.7417 29.5444 14.7417 24.8 15.775C23.2016 16.1452 21.7579 17.0031 20.6686 18.23C19.5793 19.4569 18.8983 20.9921 18.72 22.6231C18.6845 22.9329 18.6667 23.2446 18.6667 23.5564V28.3298C17.9594 28.3298 17.2811 28.6108 16.781 29.1109C16.281 29.611 16 30.2892 16 30.9965V32.3298C16 33.0371 16.281 33.7154 16.781 34.2155C17.2811 34.7156 17.9594 34.9965 18.6667 34.9965V37.6632C18.666 38.6983 18.9067 39.7193 19.3696 40.6451C19.8325 41.5709 20.5049 42.3761 21.3333 42.9966V43.6633C21.3325 44.4899 21.6389 45.2874 22.1929 45.9009C22.747 46.5143 23.5092 46.9 24.3317 46.9831C25.1541 47.0662 25.9781 46.8407 26.6436 46.3504C27.3092 45.8602 27.7688 45.1401 27.9333 44.33H36.0667C36.2312 45.1401 36.6908 45.8602 37.3564 46.3504C38.0219 46.8407 38.8459 47.0662 39.6683 46.9831C40.4908 46.9 41.253 46.5143 41.8071 45.9009C42.3611 45.2874 42.6675 44.4899 42.6667 43.6633V42.9966C43.4951 42.3761 44.1675 41.5709 44.6304 40.6451C45.0933 39.7193 45.334 38.6983 45.3333 37.6632V34.9965C46.0406 34.9965 46.7189 34.7156 47.219 34.2155C47.719 33.7154 48 33.0371 48 32.3298V30.9965C48 30.2892 47.719 29.611 47.219 29.1109C46.7189 28.6108 46.0406 28.3298 45.3333 28.3298ZM21.3333 32.3298V24.3298H42.6667V32.3298H21.3333ZM25.4027 18.3724C29.7518 17.4263 34.2535 17.4263 38.6027 18.3724C39.4476 18.5693 40.2304 18.9731 40.8807 19.5475C41.531 20.1219 42.0283 20.8489 42.328 21.6631H37.3333C37.3333 21.3095 37.1929 20.9703 36.9428 20.7203C36.6928 20.4702 36.3536 20.3297 36 20.3297H28C27.6464 20.3297 27.3072 20.4702 27.0572 20.7203C26.8071 20.9703 26.6667 21.3095 26.6667 21.6631H21.672C21.9722 20.8482 22.4703 20.1208 23.1216 19.5464C23.7728 18.9719 24.5567 18.5685 25.4027 18.3724ZM38.6667 41.6633H25.3333C24.2725 41.6633 23.2551 41.2418 22.5049 40.4917C21.7548 39.7415 21.3333 38.7241 21.3333 37.6632V34.9965H24V36.3299C24 36.6835 24.1405 37.0226 24.3905 37.2727C24.6406 37.5227 24.9797 37.6632 25.3333 37.6632C25.687 37.6632 26.0261 37.5227 26.2761 37.2727C26.5262 37.0226 26.6667 36.6835 26.6667 36.3299V34.9965H37.3333V36.3299C37.3333 36.6835 37.4738 37.0226 37.7239 37.2727C37.9739 37.5227 38.313 37.6632 38.6667 37.6632C39.0203 37.6632 39.3594 37.5227 39.6095 37.2727C39.8595 37.0226 40 36.6835 40 36.3299V34.9965H42.6667V37.6632C42.6667 38.7241 42.2452 39.7415 41.4951 40.4917C40.7449 41.2418 39.7275 41.6633 38.6667 41.6633Z" fill="white"/></svg></div>`,
  });

  return (
    <Marker position={position} icon={customMarker}>
      <Popup>
        <div className="w-[175px] ">
          <h4 className="text-center text-lg font-semibold leading-tight">
            {stopName}
          </h4>

          {showDetailedPopup && (
            <>
              <hr className="text-offText mt-1 mb-3" />

              <StopPopupDetails id={stopId} />
            </>
          )}
        </div>
      </Popup>
    </Marker>
  );
};

export default BusStopMarker;
